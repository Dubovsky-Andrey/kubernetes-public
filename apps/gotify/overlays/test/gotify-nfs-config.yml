apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: test

resources:
  - ../../base
  - gotify-nfs-config.yml

secretGenerator:
  - name: gotify-secret
    envs:
      - gotify-secret.env

patches:
  - path: service-patch.yml
    target:
      group: ""
      version: v1
      kind: Service
      name: gotify

generatorOptions:
  disableNameSuffixHash: true

replacements:
  - source:
      kind: ConfigMap
      name: gotify-nfs-config
      fieldPath: data.NFS_SERVER_PATH
    targets:
      - select:
          group: ""
          version: v1
          kind: PersistentVolume
          name: gotify-pv
        fieldPaths:
          - spec.nfs.path

  - source:
      kind: ConfigMap
      name: gotify-nfs-config
      fieldPath: data.NFS_SERVER_IP
    targets:
      - select:
          group: ""
          version: v1
          kind: PersistentVolume
          name: gotify-pv
        fieldPaths:
          - spec.nfs.server
